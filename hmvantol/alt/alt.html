<!DOCTYPE html>
<meta charset="utf-8">
<html>
<style>

body {
	font-family: sans-serif;
	font-size: 20px;
}

.axis path,
.axis line {
	fill: none;
	stroke: black;
	shape-rendering: crispEdges;
}

.line {
	fill: none;
	stroke: black;
	stroke-width: 3px;
}


</style>

<body>
<script src="//d3js.org/d3.v3.min.js" charset="utf=8"></script>
<script>

var margin = {top:40, right:20, bottom:10, left:50};
var width = {image: 720, total:720*2};
var height = {image: 480, plot:480};

var defs = d3.select("body")
	.append("svg")
	.attr("class", "defs")
	.attr("x",0)
	.attr("y",0)
	.attr("width",0)
	.attr("height",0)
	.append("defs");

defs.append("image")
	.attr("id", "satellite")
	.attr("xlink:href", "flooding_allyears.png")
	.attr("width", width.image*4)
	.attr("height", height.image*5);

defs.append("clipPath")
		.attr("id", "flooding-cp")
	.append("rect")
		.attr("x",0)
		.attr("y",0)
		.attr("height", height.image)
		.attr("width", width.image);

var before = d3.select("body")
	.append("svg")
	.attr("id", "before")
	.attr("width", width.image)
	.attr("height", height.image)
	.attr("x",0)
	.attr("y",0);

var after = d3.select("body")
	.append("svg")
	.attr("id", "after")
	.attr("width", width.image)
	.attr("height", height.image)
	.attr("x",720)
	.attr("y",0);

var x = d3.time.scale()
	.range([0,width.total - margin.left - margin.right]);

var y = d3.scale.linear()
		.range([height.plot - margin.top - margin.bottom, margin.top]);

var x_axis = d3.svg.axis()
	.scale(x)
	.orient("bottom");

var y_axis = d3.svg.axis()
	.scale(y)
	.orient("left");

var line = d3.svg.line()
	.x(function(d) { return x(d.date); })
	.y(function(d) { return y(d.fake_data); });

var svg = d3.select("body")
	.append("svg")
	.attr("id", "plot")
	.attr("width", width.total)
	.attr("height", height.plot);

svg.append("text")
	.attr("class", "x label")
	.attr("id", "label")
	.attr("text-anchor", "middle")
	.attr("x", (width.total)/2)
	.attr("y", height.plot - margin.bottom/3)
	.text("Year")
	.style("font-weight", "bold");

svg.append("text")
	.attr("class", "y label")
	.attr("id", "label")
	.attr("text-anchor", "middle")
	.attr("transform", "translate("+margin.left/3+","+(height.plot-margin.top-margin.bottom)/2+")rotate(-90)")
	.text("Flooding (m)")
	.style("font-weight", "bold");


d3.csv("flooding_alt.csv", function(data) {

	var parseDate = d3.time.format("%m/%d/%Y").parse;

	data.forEach(function(d) {
		d.fake_data = +d.fake_data;
		d.date = parseDate(d.date);
		d.x = +d.x;
		d.y = +d.y;
	});

	// console.log(data);

	defs.selectAll("g")
			.data(data).enter()
		.append("g")
			.attr("id", function(d) { return d.date.getFullYear(); })
			.attr("clip-path", "url(#flooding-cp)")
		.append("use")
			.attr("xlink:href", "#satellite")
			.attr("transform", function(d) { return "translate("+d.x+","+d.y+")"; });


	x.domain(d3.extent(data, function(d) { return d.date; }));
	y.domain(d3.extent(data, function(d) { return d.fake_data; }));

	svg.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(" + margin.left + "," + [height.plot - margin.top - margin.bottom] + ")")
		.call(x_axis);

	svg.append("g")
		.attr("class", "y axis")
		.attr("transform", "translate(" + margin.left + ",0)")
		.call(y_axis);

	svg.append("path")
		.datum(data)
		.attr("class", "line")
		.attr("transform", "translate(" + margin.left + ",0)")
		.attr("d",line);

	var dots = svg.selectAll("circle")
			.data(data).enter()
		.append("circle")
			.attr("id", function(d) { return "y" + d.date.getFullYear(); })
			.attr("cx", function(d) { return x(d.date); })
			.attr("cy", function(d) { return y(d.fake_data); })
			.attr("transform", "translate("+margin.left+",0)")
			.attr("r", "10px")
			.style("stroke", "black")
			.style("stroke-width", "3px")
			.style("fill", "white");

	d3.select("circle#y1984").style("fill", "steelblue");
	d3.select("circle#y2015").style("fill", "steelblue");

	var before = d3.select("#before")
		.append("svg")
			.attr("viewBox", "0 0 " + width.image + " " + height.image)
			.style("display", "inline")
			.style("height", "1em")
			.style("width", (width.image/height.image) + "em")
		.append("use")
			.attr("id", "image1")
			.attr("xlink:href", "#1984");

	var after = d3.select("#after")
		.append("svg")
			.attr("viewBox", "0 0 " + width.image + " " + height.image)
			.style("display", "inline")
			.style("height", "1em")
			.style("width", (width.image/height.image) + "em")
		.append("use")
			.attr("id", "image2")
			.attr("xlink:href", "#2015");

	d3.select("#before")
		.append("text")
		.attr("id", "before-text")
		.text("1984")
		.attr("x",10)
		.attr("y",30)
		.style("font-size", "24px")
		.style("fill","white");

	d3.select("#after")
		.append("text")
		.text("2015")
		.attr("x",10)
		.attr("y",30)
		.style("font-size", "24px")
		.style("fill","white");

	var active = null;


	dots.on({
		mouseover: function(d) {
			d3.select(this).style("fill", "steelblue");
		},
		mouseout: function(d) {
			if (this != active) {
				d3.select(this).style("fill", "white");
			}
		},
		click: function(d) {
			d3.select("circle#y1984").style("fill", "white");
			d3.select(active).style("fill", "white");
			active = this;
			d3.select(active).style("fill", "steelblue");
			d3.select("use#image1").attr("xlink:href", "#" + this.id.substring(1,5));
			d3.select("#before-text").text(this.id.substring(1,5));
		}

	});


});

</script>
</body>
</html>